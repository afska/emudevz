---
main:
  run: |
    if (level.hasStoredContent) $.goTo("exercise");
    else {
      set((m) => {
        m.chat.stopBlock = locales.get("not_now");
        m.$canRun = false;
        m.$canEdit = false;
      });
    }
  messages:
  - la pila ğŸ§±  es una estructura LIFO ("Last In, First Out") que los programas usan para almacenar valores
  - la longitud actual de la pila es medida por el "Stack Pointer" ([SP])
  - en un procesador 6502, vive en la memoria entre $0100 y $01FF ğŸ
  - "[SP] inicialmente es $FF, que apunta al Ãºltimo byte de la pila ($01FF)"
  - cuando un byte se agrega a la pila, [SP] pasa a ser $FE (o direcciÃ³n de memoria $01FE), y asÃ­
  - aquÃ­ hay un ejemplo de una pila con 2 valores (en $01FF y $01FE), por lo que [SP] apunta a $01FD
  - <{stack.png}>
  responses:
  - Â¿y cÃ³mo puedo poner valores en ella? [put]

put:
  messages:
  - "puedes usar dos instrucciones:"
  - "â¬†ï¸  `PHA` (\"PusH Accumulator\"), que pone [A] en la pila"
  - <{stack_PHA.png}>
  - "â¬‡ï¸  `PLA` (\"PulL Accumulator\"), que saca el Ãºltimo byte de la pila, y lo carga en [A]"
  - <{stack_PLA.png}>
  responses:
  - Â¿puedes explicarme el cÃ³digo de ejemplo? [example]

example:
  run-after-messages: |
    set((m) => m.$canRun = true);
  messages:
  - crea dos bucles â°
  - "`@save` pone nÃºmeros impares entre $4080 y $4087"
  - y `@load` pone esos nÃºmeros en orden inverso desde $4098 hasta $409F
  - el primero <pone> valores en la pila, el segundo <saca> valores de la pila
  - ahora tu depurador tiene una secciÃ³n Pila ğŸ‘€
  - ejecuta el cÃ³digo y compruÃ©balo con tus propios ojos â©
  responses:
  - buenÃ­simo, ahora entiendo [exercise]
  - (*) Â¿por quÃ© `PLA` no saca el valor de la pila? [remove]

remove:
  messages:
  - lo "saca", solamente incrementando [SP]
  - el valor queda en memoria, no obstante ğŸ˜…
  - no hay razÃ³n para quitarlo, ya que solo accederÃ­as a la pila con las instrucciones apropiadas
  responses:
  - ...example

exercise:
  run: |
    level.test.precode = "pretest.asm";
    level.fillContentFromTemp();
    set((m) => {
      m.chat.stopBlock = null;
      m.$canRun = true;
      m.$canEdit = true;
      m.content.useTemp = false;
    });
  messages:
  - ahora, un ejercicio
  - ğŸ“š  _-_borra todo el cÃ³digo_--_
  - _-_tu pila tendrÃ¡ 2 valores precargados aleatorios_--_
  - ğŸ“š  _-_solo necesitas sacar y cargarlos en 2 direcciones de memoria consecutivas_--_
  - ğŸ“š  _-_luego, hacer un salto indirecto `JMP` _--_ğŸ¦˜
  - _-_p. ej. si tu pila tiene -de arriba a abajo- $C4 y $3E, cuando tu programa finalice, [PC] deberÃ­a valer $3EC4_--_
  - ğŸ“š  _-_corre `test` cuando estÃ© todo listo _--_ğŸ˜Š
  responses: []
