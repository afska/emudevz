---
main:
  run: |
    set((m) => m.chat.winOnEnd = true);
  messages:
  - ok
  - "{5}it's time"
  - "{10}I think you're ready to know"
  responses:
  - what? [what]

what:
  messages:
  - I'm actually...
  - "{30}the creator of BrokenNEEES"
  - "{30}it has been rough since <AI> took over and most manual programming efforts have died"
  - "{5}I miss <manual programming>, a lot"
  - "{5}I wanted to make someone out there enjoy programming like I do"
  - "{5}then I found you, and your interest in emulation made me want to help"
  - "{10}the emulator isn't actually <broken>, those were bugs I planted on purpose ğŸ˜…"
  - "{5}the goal was to have an excuse to teach someone something I love"
  - "{5}that is why I always have some code ready to nudge you forward"
  - "{5}I hope you are not mad"
  responses:
  - why fake bugs? [why]
  - so, what now? [integrate]

why:
  messages:
  - you don't learn the soul of an emulator by reading, you learn it by doing!
  - and being able to actually play the games without bugs is a great motivator ğŸ‘¾
  responses:
  - (*) so your "real NEEES" was also your emulator? [real]
  - fine, what is next? [integrate]

real:
  messages:
  - ğŸ˜… ğŸ¤£ â˜ ï¸
  responses:
  - ...why

integrate:
  run: |
    {{Top}}.load(null, "rom");
  messages:
  - I'm gonna give you full control over the ğŸ•¹ï¸  Emulator
  - let's see...
  run-after-messages: |
    level.startEffect("earthquake");
    setTimeout(() => {
      bus.emit("patching-end");
    }, 500);
  events: 
  - patching-end [done]

done:
  run: |
    level.stopEffect();
    book.unlock("useConsole");
  messages:
  - âœ…  done!
  - <! ğŸ•¹ï¸  NEEES integrated.
  - now, the ğŸ•¹ï¸  icon in the emulator will glow âœ¨
  - if you enable it, the frontend will look up an `Emulator` class in ğŸ“„  ~/code/index.js~
  - and there will be no trace of BrokenNEEES
  responses:
  - but I don't have that class! [exercise]

exercise:
  messages:
  - yeah, let's hand over the missing code to you
  - you'll have full control of, at least, the ğŸŒ€  emulator core
  - |-
    ğŸ“š  create code files from these templates:
      ğŸ“„  ~/tmpl/Emulator.js~
      ğŸ“„  ~/tmpl/saveStates.js~
      ğŸ“„  ~/tmpl/mappers/mappers.js~
      ğŸ“„  ~/tmpl/mappers/0_NROM.js~
  - ğŸ“š  import `Emulator.js` and export the object under the `Emulator` key in ğŸ“„  ~/code/index.js~
  - notice that, when doing this, only <NROM> (mapper 0) games will work
  - you will fix that in the ğŸ—œï¸  Mappers chapter
  responses:
  - (*) what about the tests? ğŸ§ª [tests]
  - â–¶ï¸  continue [end]

tests:
  messages:
  - you want the unit tests? ğŸ¤”
  - yeah, if you improve the emulator later, I guess they can be useful to ensure everything works
  - |-
    and of course you'll have to eventually update them, so here they are:
      ğŸ“„  ~/tmpl/tests/apu.test.js~
      ğŸ“„  ~/tmpl/tests/bus.test.js~
      ğŸ“„  ~/tmpl/tests/cartridge.test.js~
      ğŸ“„  ~/tmpl/tests/cpu.test.js~
      ğŸ“„  ~/tmpl/tests/cpu_addressing_modes_1.test.js~
      ğŸ“„  ~/tmpl/tests/cpu_addressing_modes_2.test.js~
      ğŸ“„  ~/tmpl/tests/cpu_instructions_1.test.js~
      ğŸ“„  ~/tmpl/tests/cpu_instructions_2.test.js~
      ğŸ“„  ~/tmpl/tests/cpu_instructions_3.test.js~
      ğŸ“„  ~/tmpl/tests/cpu_instructions_4.test.js~
      ğŸ“„  ~/tmpl/tests/cpu_instructions_5.test.js~
      ğŸ“„  ~/tmpl/tests/ppu.test.js~
  responses:
  - ...exercise
