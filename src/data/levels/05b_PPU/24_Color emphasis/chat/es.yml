main:
  messages:
  - el PPU es capaz de "transformar" los colores de salida hasta cierto punto
  - üé≠  PPUMask tiene algunos bits que activan el <modo de escala de grises> o <√©nfasis de color>
  - es decir, enfatizando los componentes rojo, verde o azul de cada color
  responses:
  - ¬øc√≥mo funciona? [how]

how:
  messages:
  - el bit 0 convierte la salida a <escala de grises>
  - el bit 5 enfatiza el <rojo> (oscureciendo el verde y el azul en un 25%)
  - el bit 6 enfatiza el <verde> (oscureciendo el rojo y el azul en un 25%)
  - el bit 7 enfatiza el <azul> (oscureciendo el rojo y el verde en un 25%)
  - si los tres bits de √©nfasis est√°n habilitados al mismo tiempo, todos los colores estar√°n un ~25%~ m√°s oscuros
  - el <√©nfasis de color> es independiente del <modo de escala de grises>, por lo que los bits de √©nfasis a√∫n ti√±en el color de la imagen en escala de grises
  responses:
  - entonces... [exercise]

exercise:
  messages:
  - abre üìÑ  ~/docs/ppu/video_registers.en.md~
  - üìö  en üé≠  `PPUMask`, edita el m√©todo `onLoad()` y usa `addField(...)` para mapear los bits `grayscale`, `emphasizeRed`, `emphasizeGreen` y `emphasizeBlue`
  - |-
    üìö  agrega este m√©todo:
    **transform(color)**:
      **->** divide el color en componentes `r`, `g` y `b`:
        ```javascript let r = (color >> 0) & 0xff;```
        ```javascript let g = (color >> 8) & 0xff;```
        ```javascript let b = (color >> 16) & 0xff;```

      **->** si ```javascript this.grayscale```:
        **->** `r = g = b = Math.floor((r + g + b) / 3)`

      **->** si ALG√öN bit de √©nfasis est√° habilitado:
        **->** verifica si TODOS los bits de √©nfasis est√°n habilitados
          (llamemos a esto `all`)
        
        **->** para cada `r`, `g` y `b`:
          **->** si el bit NO est√° habilitado o todos (`all`) est√°n habilitados:
           **->** disminuye el brillo del componente en un ~25%~:
              por ejemplo, el rojo ser√≠a:
              ```javascript r = Math.floor(r * 0.75)```

      **->** retorna el color actualizado:
        ```javascript 0xff000000 | (r << 0) | (g << 8) | (b << 16);```
  - üìö  y lo m√°s importante, ahora `PPU::plot(...)` necesita llamar al m√©todo transform de üé≠  `PPUMask` en lugar de usar directamente el `color`
  responses: []

corollary:
  messages:
    - el √©nfasis de color se usa, por ejemplo, en üïäÔ∏è üõ∞Ô∏è  ~Spacegulls~ durante la pausa
    - intenta pausar el juego con <Start> y la pantalla se volver√° rojiza
  responses:
    - ‚ñ∂Ô∏è  continuar [end]
