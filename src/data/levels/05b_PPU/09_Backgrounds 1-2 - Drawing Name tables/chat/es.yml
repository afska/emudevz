---
main:
  messages:
  - ahora que podemos...
  - Â¡comenzaremos a dibujar ğŸï¸  fondos!
  responses:
  - Â¡por fin! [exercise]

exercise:
  messages:
  - esta vez, tendrÃ¡s que seguir la documentaciÃ³n
  - lee ğŸ“„  ~/docs/ppu/background_rendering.es.md~
  - y trata de entender cÃ³mo renderizar fondos en <escala de grises>
  - cuando hayas terminado...
  - ğŸ“š  crea una clase ğŸï¸  `BackgroundRenderer`
  - ğŸ“š  su constructor debe recibir y asignar una propiedad `ppu` con la instancia de PPU
  - |-
    ğŸ“š  <haz estos cambios> en la clase ğŸ–¥ï¸  `PPU`:
    **constructor(cpu)**:
      **->** instancia el renderizador de fondos:
        ```javascript this.backgroundRenderer = new BackgroundRenderer(this)```
      (Â¡recuerda importarlo si lo definiste en otro archivo!)
    **step(...)**:
      **->** elimina el cÃ³digo de prueba (```javascript // <test>...</test>```)
    **_onVisibleLine()**:
      **->** si el ciclo es ~0~, llama a `backgroundRenderer.renderScanline()`
  - |-
    ğŸ“š  ahora, en la clase ğŸï¸  `BackgroundRenderer`, define:
    **renderScanline()**:
      **->** <agrega el cÃ³digo necesario> para renderizar una lÃ­nea completa del fondo
  - Â¡adiÃ³s!
  responses:
  - "\"Â¿agrega el cÃ³digo necesario\"? Â¿en serio? Â¿eso es todo? [questions]"

questions:
  messages:
  - Â¿quÃ©? Â¿necesitas ayuda?
  responses:
  - (*) entonces, Â¿cuÃ¡ntos pÃ­xeles deberÃ­a dibujar? â¹ [howmany]
  - (*) Â¿cÃ³mo sÃ© la lÃ­nea actual? ğŸŒ  [line]
  - (*) ayÃºdame un poco ğŸ†˜ [help]
  - (*) lo hice, pero algunos juegos no parecen funcionar ğŸ¤” [work]

howmany:
  messages:
  - la pantalla es de ~256x240~
  - necesitas `plot`ear exactamente 256 pÃ­xeles para cada lÃ­nea visible
  - en la vida real, el hardware renderiza un pÃ­xel por ciclo, pero aquÃ­ lo haremos todo a la vez (por simplicidad)
  - por lo tanto, solo deberÃ­as renderizar la lÃ­nea cuando `cycle` sea 256
  responses:
  - ...questions

line:
  messages:
  - la lÃ­nea actual estÃ¡ representada por ```javascript this.ppu.scanline```
  responses:
  - ...questions

help:
  messages:
  - sabes que ```javascript y = this.ppu.scanline```
  - y que necesitas dibujar desde ~x = 0~ hasta ~x = 255~
  - tambiÃ©n sabes que la pantalla es una cuadrÃ­cula de ~32x32~ tiles (de ~8x8~ pÃ­xeles cada uno)
  - y por Ãºltimo, Â¡ya sabes cÃ³mo dibujar un tile usando tu clase ğŸ•Šï¸  `Tile`!
  - |-
    una forma de implementar esto es hacer algo como:
      ```javascript
      const y = this.ppu.scanline;
      for (let x = 0; x < 256; x += 8) {
        const nameTableId = 0; // TODO: Obtener el id de la name table
        const patternTableId = 0; // TODO: Obtener el id de la pattern table

        const tileX = Math.floor(x / 8);
        const tileY = Math.floor(y / 8);
        const tileIndex = tileY * 32 + tileX;
        const tileId = 0; // TODO: Leer el id del tile desde la memoria

        const tileInsideY = y % 8;

        const tile = new Tile(this.ppu, patternTableId, tileId, tileInsideY);
        for (let xx = 0; xx < 8; xx++) {
          const colorIndex = tile.getColorIndex(xx);
          // TODO: Plotear cada pixel del tile
        }
      }```
  responses:
  - ...questions

work:
  messages:
  - bueno, Â¡todavÃ­a tenemos mucho que hacer!
  - lo importante es que algunos juegos ahora deberÃ­an mostrar su fondo correctamente
  - por ejemplo, echa un vistazo a ğŸ“„  ~/roms/_test/hello_world.neees~
  - y compara la salida alternando entre BrokenNEEES y tu emulador âœ¨
  responses:
  - ...questions
