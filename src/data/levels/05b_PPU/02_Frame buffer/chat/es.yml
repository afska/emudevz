---
main:
  run: |
    {{Top}}.load("frameBuffer.png");
  messages:
  - almacenaremos nuestros datos de imagen en algo llamado <frame buffer>
  - es bÃ¡sicamente una gran matriz con el color de cada pÃ­xel
  - cada elemento es un nÃºmero de 32 bits __$aabbggrr__
  - "\"aa\" representa la opacidad (en nuestra NEEES siempre es $FF)"
  - "\"bb\", \"gg\" and \"rr\" representan la cantidad de <azul>, <verde> y <rojo>"
  responses:
  - (*) Â¿puedes darme algunos ejemplos de colores? [examples]
  - Â¡quiero dibujar algo en la pantalla! ğŸ–Œï¸ [integrate]
  - <<level.isCompleted || m.$exercise>> ğŸ“š  llÃ©vame a la acciÃ³n [draw]

examples:
  messages:
  - "aquÃ­ tienes algunos colores de ejemplo:"
  - "â¤ï¸  ```javascript 0xFF0000FF``` = rojo"
  - "ğŸ’š  ```javascript 0xFF00FF00``` = verde"
  - "ğŸ’™  ```javascript 0xFFFF0000``` = azul"
  - "âšª  ```javascript 0xFFFFFFFF``` = blanco"
  - "ğŸ–¤  ```javascript 0xFF000000``` = negro"
  - "ğŸ”˜  ```javascript 0xFF989898``` = gris"
  - "ğŸ’›  ```javascript 0xFF00F8F8``` = amarillo"
  responses:
  - ...main

integrate:
  run: |
    {{Top}}.load(null, "rom");
  messages:
  - primero que nada, voy a integrar tu ğŸ–¥ï¸  PPU en el emulador
  - deberÃ­a ser rÃ¡pido...
  run-after-messages: |
    level.startEffect("earthquake");
    setTimeout(() => {
      bus.emit("patching-end");
    }, 500);
  events: 
  - patching-end [done]

done:
  run: |
    level.stopEffect();
    book.unlock("usePPU");
  messages:
  - âœ”ï¸  Â¡listo!
  - ahora, el Ã­cono ğŸ–¥ï¸  en el emulador brillarÃ¡ âœ¨
  - como casi no hay cÃ³digo PPU, por ahora no se mostrarÃ¡ nada
  - Â¡pero llegaremos allÃ­!
  responses:
  - programemos esto ğŸ¤Ÿ [draw]

draw:
  run: |
    set((m) => m.$exercise = true);
    {{Top}}.load(null, "rom");
  messages:
  - |-
    ğŸ“š  _-_ok, vamos a agregar esto al constructor de tu PPU:
      ```javascript
      this.frameBuffer = new Uint32Array(256*240);

      // llenar la pantalla entera de rojo:
      for (let i = 0; i < 256 * 240; i++)
        this.frameBuffer[i] = 0xff0000ff;```_--_
  - _-_modifica tu mÃ©todo `step` para que reciba un callback `onFrame` como parÃ¡metro_--_
  - |-
    _-_luego, cada vez que detectes un nuevo frame (justo despuÃ©s de ```javascript this.frame++;```), llÃ¡malo con el frame buffer, asÃ­:
      ```javascript onFrame(this.frameBuffer);```_--_
  - _-_Â¡pruÃ©balo! al iniciar una ROM, deberÃ­a pintar de rojo la pantalla_--_ğŸ”´
  responses: []
