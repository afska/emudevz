---
main:
  messages:
  - nuestra CPU casi estÃ¡ funcionando ahora
  - hablemos de <mappers> ðŸ§ 
  - son circuitos dentro del cartucho que controlan cÃ³mo se leen los datos de la ROM por la consola
  - cada juego utiliza un mapper especÃ­fico, pero algunos usan "Mapper 0"
  responses:
  - entonces, Â¿quÃ© es Mapper 0? ðŸ¤” [mapper0]

mapper0:
  messages:
  - es el mapper mÃ¡s bÃ¡sico que hay
  - en el que uno o dos chips PRG-ROM de 16 KiB estÃ¡n directamente mapeados a la memoria de la ðŸ–¥ï¸  CPU
  - y un chip CHR-ROM (o RAM) de 8 KiB estÃ¡ mapeado a memoria de la ðŸ‘¾  PPU
  responses:
  - (*) Â¿cuÃ¡l es el beneficio de usar un mapper mÃ¡s complejo? [complex]
  - âœ”ï¸  genial, Â¿cÃ³mo puedo implementar los mappers? [implement]

complex:
  messages:
  - los mappers mÃ¡s avanzados ofrecen mÃ¡s flexibilidad a los desarrolladores de juegos
  - por ejemplo, pueden agregar RAM, generar IRQs en ciertas scanlines, o incluso cambiar entre diferentes bancos de datos ROM
  - esto permite que los juegos tengan una lÃ³gica mÃ¡s compleja, guarden datos o usen efectos de sonido y grÃ¡ficos avanzados
  - pero para juegos simples, Mapper 0 es mÃ¡s que suficiente ðŸ˜Š
  responses:
  - ...mapper0

implement:
  messages:
  - pelearÃ¡s con ellos en el capÃ­tulo de Mappers
  - como siempre, el primero es gratis ðŸ˜Ž
  - asÃ­ que revisa mi implementaciÃ³n de "Mapper 0" en ðŸ“„  ~/lib/NROM.js~
  - lo Ãºnico que tienes que hacer es integrarlo con tu cÃ³digo existente
  - ðŸ“š  crea un mÃ³dulo `mappers` que contenga todos los mappers
  - |-
    por ahora, deberÃ­a verse asÃ­:
      ```javascript
      import NROM from "/lib/NROM";

      export default { 0: NROM }```
  - |-
    importa ese mÃ³dulo donde tengas tu clase `NEEES`, y agrega este cÃ³digo:
      ```javascript
      class NEEES {
        constructor(bytes) {
          this.cartridge = new Cartridge(bytes);

          // >>> ðŸ‘‡
          const Mapper = mappers[this.cartridge.header.mapperId];
          if (!Mapper) throw new Error("Invalid mapper.");
          this.mapper = new Mapper(this);
          // <<<
          
          this.cpu = new CPU(this.mapper); // <<< ðŸ‘ˆ
        }

        // ... <rest of your NEEES class> ...
      }```
  responses:
  - espera, Â¿ahora `CPU` recibe el mapper? [wait]

wait:
  messages:
  - sÃ­, cambia `CPU` y `CPUMemory` para que reciban el mapper en lugar del cartucho
  - "y modifica tu `CPUMemory` de la siguiente manera:"
  - "  - elimina el mapeo de prueba que agregamos en el nivel 'Inserte cartucho' (el que mapea $8000-$BFFF a PRG-ROM)"
  - "  - mapea $4020-$FFFF para que redirija todo al mapper (`read(...)` tiene que llamar a `mapper.cpuRead(...)` y `write(...)` tiene que llamar a `mapper.cpuWrite(...)`)"
  responses: []
