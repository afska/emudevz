---
main:
  messages:
  - la ğŸ§   CPU y ğŸ”Š  APU se comunican entre ellas a travÃ©s de un conjunto de 21 registros mapeados en memoria
  - estos viven en las direcciones CPU $4000-$4013, $4015 y $4017
  - echa un vistazo a ğŸ“„  ~/docs/apu/audio_registers.es.md~
  responses:
  - dame un ejemplo ğŸ™ [example]
  - <<level.isCompleted || m.$exercise>> ğŸ“š  llÃ©vame a la acciÃ³n [useit]

example:
  messages:
  - digamos que un juego necesita configurar el Canal Pulso 1 con un ciclo de trabajo del ~50%~ y un volumen constante de 6
  - esto se gestiona mediante los bits de $4000 (ğŸŸ¦  Pulse1Control)
  - en la columna ~Bits~, ~DD~ es el ciclo de trabajo, ~C~ la bandera de volumen constante y ~NNNN~ el volumen
  - asÃ­ que, en este caso, el juego escribe un 150 (binario ~10010110~) en $4000
  - y luego la ğŸ”Š  APU usa ese valor para modificar la onda de pulso
  - la escritura en $4000 afecta 4 parÃ¡metros al mismo tiempo (~DD~, ~L~, ~C~ y ~NNNN~)
  - <{Pulse1Control.png}>
  responses:
  - entonces, Â¿estos registros solo almacenan nÃºmeros? ğŸ”¢ [numbers]

numbers:
  messages:
  - sÃ­, pero algunos producen <efectos especiales> cuando la ğŸ§   CPU escribe en ellos
  - estos efectos secundarios pueden restablecer la duraciÃ³n de las notas, iniciar barridos de frecuencia, Â¡o incluso silenciar canales completos!
  - programÃ© una clase que te ayudarÃ¡ a implementar esto, deberÃ­as usarla ğŸ“–
  responses:
  - Â¿cÃ³mo puedo usarla? [useit]

useit:
  run: |
    set((m) => m.$exercise = true);
  messages:
  - lee la documentaciÃ³n en ğŸ“„  ~/docs/lib/InMemoryRegister.es.md~
  - y usa ğŸ“„  ~/tmpl/apu/AudioRegisters.js~ como plantilla para el archivo de registros de audio
  - los registros para ğŸŸ¦  `PulseControl` ya estÃ¡n implementados
  - nota cÃ³mo llaman a `addField(...)` para cada bit definido en la columna ~Bits~
  - "esto crea <propiedades automÃ¡ticas>: despuÃ©s de una escritura, la APU puede acceder a sus valores (p. ej. ```javascript pulse1Control.dutyCycleId```)"
  - ğŸ“š  crea una clase `AudioRegisters`, utilizando esa plantilla
  - |-
    ğŸ“š  agrega una propiedad `registers` a ğŸ”Š  `APU`, asignada a:
         ```javascript new AudioRegisters(this)```
  - "ğŸ“š  por Ãºltimo, mapÃ©alos en ğŸ  `CPUMemory` (regiones $4000-$4013, $4015 y $4017):"
  - <las lecturas> deberÃ­an retornar ```javascript this.apu.registers.read(address)```
  - <las escrituras> deberÃ­an llamar a ```javascript this.apu.registers.write(address, value)``` y retornar
  - ten cuidado con ğŸ§®  APUFrameCounter, ya que comparte su direcciÃ³n con el segundo puerto de ğŸ®  mando; Â¡no mapees <las lecturas>! Â¡solo <las escrituras>!
  responses: []
