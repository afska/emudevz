---
main:
  messages:
  - cuando estÃ¡ habilitada, la envolvente puede disminuir gradualmente el volumen del canal, produciendo un <decay> (desvanecimiento) ğŸ“‰
  - siempre comienza en volumen mÃ¡ximo (~15~) y los juegos controlan quÃ© tan lento disminuye el volumen configurando un perÃ­odo de divisor
  - cuando el volumen llega a 0, puede reiniciarse a 15 si su bandera de bucle estÃ¡ encendida
  responses:
  - Â¿y cuando estÃ¡ deshabilitada? [disabled]

disabled:
  messages:
  - cuando estÃ¡ deshabilitada, el canal simplemente emite el volumen establecido en los primeros 4 bits de ğŸŸ¦  PulseControl
  - <{volume_envelope_disabled.png}>
  - observa cÃ³mo reutilizan esos 4 bits como perÃ­odo de divisor cuando estÃ¡ habilitada
  - <{volume_envelope_enabled.png}>
  responses:
  - suena fÃ¡cil! [exercise]

exercise:
  messages:
  - |-
    ğŸ“š  crea una clase ğŸ“  `VolumeEnvelope` con lo siguiente:
    **constructor()**:
      **->** asigna ```javascript this.startFlag = false```
      **->** asigna ```javascript this.dividerCount = 0```
      **->** asigna ```javascript this.volume = 0```
    **clock(period, loop)**:
      **->** si la bandera de inicio (<start flag>) estÃ¡ encendida:
        **->** apaga la bandera de inicio
        **->** asigna el volumen a 15
        **->** asigna el contador del divisor a `period`
        **->** retorna
      **->** si el contador del divisor es mayor que 0:
        **->** decrementa el contador del divisor
        **->** retorna
      **->** __(en este punto, el divisor es 0, asÃ­ que hay que actuar)__
      **->** reinicia el contador del divisor a `period`
      **->** si el volumen es 0:
        **->** si `loop`:
          **->** reinicia el volumen a 15
      **->** si no:
        **->** decrementa el volumen
  - |-
    ğŸ“š  en ğŸŸ¦  `PulseChannel`:
    **->** importa esa clase y agrega una propiedad `volumeEnvelope` con una nueva instancia
    **->** modifica **sample()** para que el volumen del oscilador dependa de la bandera `constantVolume` de ğŸŸ¦  PulseControl:
      **->** si se usa volumen constante, mantiene la lÃ³gica actual
      **->** si no, usa ```javascript this.volumeEnvelope.volume```
    **->** implementa este mÃ©todo:
    **quarterFrame()**:
      **->** llama al mÃ©todo `clock(...)` de la envolvente
        (para `period`, usa `volumeOrEnvelopePeriod` de ğŸŸ¦  PulseControl)
        (para `loop`, usa `envelopeLoopOrLengthCounterHalt` de ğŸŸ¦  PulseControl)
  - |-
    ğŸ“š  implementa en ğŸ•›  `PulseTimerHighLCL`:
    **onWrite(value)**:
      **->** __mantiene el comportamiento existente__
      **->** activa la bandera `startFlag` de la envolvente del canal
  responses: []
