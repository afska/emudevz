---
main:
  messages:
  - "los Canales de Pulso pueden silenciarse de mÃºltiples formas:"
  - ğŸ”‡  cuando los juegos silencian el canal con una escritura a ğŸ›ï¸  APUControl
  - ğŸ“  cuando el contador de longitud es 0
  - ğŸ§¹  cuando la unidad de barrido estÃ¡ silenciada
  - ğŸ”ˆ  cuando el volumen del canal es 0
  - hasta ahora, solo cubrimos la Ãºltima situaciÃ³n
  - (mÃ¡s o menos, todavÃ­a tenemos que ocuparnos de la envolvente, Â¡pero eso vendrÃ¡ despuÃ©s!)
  - "nuestro prÃ³ximo objetivo es manejar las dos primeras: silencios de canal y el contador de longitud"
  responses:
  - Â¿y quÃ© es un contador de longitud? [length]

length:
  messages:
  - Â¡es lo que usa la APU para manejar la <longitud> de las notas!
  - los juegos <cargan> su valor inicial para indicar la longitud de la nota
  - luego ese valor se reduce cada half frame
  - Â¡y cuando llega a 0, el canal se silencia! ğŸ¤
  responses:
  - (k) Â¿cÃ³mo cargarÃ­a su valor un juego? [load]
  - (k) Â¿siempre reduce su valor en los half frames? [decrement]
  - (l) vamos a programarlo [exercise]

load:
  messages:
  - escribe en un registro que tiene <Length Counter Load> (o su forma abreviada, <LCL>) en su nombre
  - en el caso de los Canales de Pulso, es ğŸ•›  PulseTimerHighLCL, donde los 5 bits altos son el <Ã­ndice de longitud>
  - ese Ã­ndice apunta a una tabla fija con todas las longitudes disponibles, revisa ğŸ“„  ~/lib/apu/noteLengths.js~
  - <{length_counter_load.png}>
  responses:
  - Â¿y si un juego necesita una longitud que no estÃ¡ en la lista? [otherlengths]

otherlengths:
  messages:
  - Â¡no es posible!
  - al menos con este tipo de contador de longitud
  - es por eso que los juegos no suelen usar este mÃ©todo y terminan cambiando el volumen a mano, o usando la envolvente
  responses:
  - ...length

decrement:
  messages:
  - solo si su <bandera de detenciÃ³n> (<halt>) no estÃ¡ activada
  - esa serÃ­a el bit <L> en ğŸŸ¦  PulseControl
  - <{length_counter_halt.png;30x30}>
  responses:
  - ...length

exercise:
  messages:
  - |-
    ğŸ“š  crea una clase ğŸ“  `LengthCounter` con lo siguiente:
    **constructor()**:
      **->** llama a ```javascript this.reset()```
    **reset()**:
      **->** asigna ```javascript this.counter = 0```
    **isActive()**:
      **->** retorna si ```javascript this.counter``` es mayor a 0 o no
    **clock(isEnabled, isHalted)**:
      **->** si `!isEnabled`:
        **->** llama a ```javascript this.reset()```
      **->** si no:
        **->** si ```javascript this.isActive()``` y `!isHalted`:
          **->** disminuye el contador
  - |-
    ğŸ“š  en ğŸŸ¦  `PulseChannel`:
    **->** importa esa clase y agrega una propiedad `lengthCounter` con una nueva instancia
    **->** modifica **sample()**, para que si ```javascript !this.isEnabled()``` o el contador de longitud no estÃ¡ activo, retorne el Ãºltimo sample generado, sin cambiar nada
    **->** agrega los mÃ©todos que se describen abajo
    **quarterFrame()**:
      **[!]** dÃ©jalo vacÃ­o por ahora
    **halfFrame()**:
      **->** llama al mÃ©todo `clock(...)` del contador de longitud
        (usa ```javascript this.isEnabled()``` como primer argumento)
        (para la bandera de detenciÃ³n, busca `envelopeLoopOrLengthCounterHalt` en el registro ğŸŸ¦  PulseControl)
  - |-
    ğŸ“š  en ğŸ”Š  `APU`:
    **onQuarterFrameClock()**:
      **->** llama a `quarterFrame()` en las dos instancias de canal de pulso
    **onHalfFrameClock()**:
      **->** llama a `halfFrame()` en las dos instancias de canal de pulso
  - |-
    ğŸ“š  implementa en ğŸ•›  `PulseTimerHighLCL`:
    **onLoad()**:
      **->** usa ```javascript this.addField(...)``` para definir un campo `lengthCounterLoad` de 5 bits desde el bit 3
    **onWrite(value)**:
      **->** __mantÃ©n el comportamiento existente__
      **->** determina la nueva longitud accediendo al array `noteLengths` con el Ã­ndice ```javascript this.lengthCounterLoad```
        usa ğŸ“„  ~/lib/apu/noteLengths.js~ para obtener el array
      **->** asigna la propiedad `counter` del contador de longitud del canal al nuevo valor
  responses: []
