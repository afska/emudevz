---
main:
  run: |
    set((m) => {
      m.chat.winOnEnd = true;
      m.$canRun = false;
    });
  messages:
  - si esto fuera un juego extraÃ±o en el que tienes que programar un emulador
  - este serÃ­a un <jefe final> ğŸ‘¹
  - ~NEEEStest~ es un homebrew que prueba exhaustivamente el funcionamiento de la CPU
  - ejecutarÃ© tu emulador y registrarÃ© cada instrucciÃ³n
  - "comparando cada lÃ­nea con el siguiente \"golden log\":"
  - ğŸ“„  ~/roms/_test/golden.log~
  - ğŸ“„  ~/roms/_test/golden_log_format.md~
  responses:
  - Â¿quÃ© es un golden log? ğŸ† [golden]

golden:
  messages:
  - un archivo que documenta el resultado de correr esa misma ROM de pruebas, pero creado por un emulador que se demostrÃ³ que funciona correctamente âœ…
  - "tiene -en orden-: el [PC], el bytecode, el cÃ³digo ensamblador decompilado, el estado de todos los registros (`P` es el Registro de Banderas), y el contador de ciclos"
  - hasta ahora, solo he ejecutado pruebas bÃ¡sicas en tu cÃ³digo
  - esto abarcarÃ¡ todo tipo de casos extremos, verificando que tu CPU sea sÃ³lida
  - si encuentras discrepancias, tendrÃ¡s que averiguar la causa o buscar ayuda en lÃ­nea
  - Â¡usa el botÃ³n â©  y llega al final del golden log!
  run-after-messages: |
    set((m) => {
      m.$canRun = true;
    });
  events:
  - cpu-bug-page-boundary [pageboundary]
  - cpu-bug-unexpected [unexpected]
  - golden-log-end [success]

pageboundary:
  run: |
    set((m) => {
      m.$canRun = false;
    });
  messages:
  - ah... el <page boundary bug> ğŸ˜…
  - Â¡me olvidÃ© completamente de Ã©l!
  responses:
  - Â¿el quÃ©? [thewhat]

thewhat:
  messages:
  - hay un bug en cÃ³mo la NEEES procesa el modo de direccionamiento "Indirect"
  responses:
  - Â¡Â¿un bug en el hardware?! ğŸ¤” [hardware]

hardware:
  messages:
  - sÃ­, y si queremos emular el hardware precisamente... tenemos tambiÃ©n que emular los bugs ğŸ˜…
  responses:
  - Â¿no puedo simplemente arreglar el bug? ğŸ˜¤ [fix]

fix:
  messages:
  - puedes, pero estarÃ­as rompiendo la compatibilidad con algunos juegos que dependen (ya sea accidentalmente o intencionalmente) de ese bug
  - improvisÃ© un archivo de documentaciÃ³n corto hablando sobre esto
  - estÃ¡ en ğŸ“„  ~/docs/cpu/page_boundary_bug.es.md~
  - ğŸ“š  Â¡introduce el bug e intenta de nuevo!
  run-after-messages: |
    set((m) => {
      m.$canRun = true;
    });
  events:
  - ...golden

unexpected:
  messages:
  - ğŸ’¥  Â¡Â¿quÃ©?! ğŸ’¥
  - eso fue inesperado
  - intenta analizar esa lÃ­nea exacta en el archivo de log
  - "la instrucciÃ³n que fallÃ³ estÃ¡ en la <lÃ­nea anterior>, por ejemplo:"
  - <{failure_example.png}>
  - "aquÃ­, la instrucciÃ³n `ADC #$69` fallÃ³: deberÃ­a haber cambiado [A] de $00 a $69, pero cambiÃ³ a $4B en su lugar"
  - deberÃ­as poder encontrar la causa usando este mÃ©todo
  - si no, pide ayuda en lÃ­nea ğŸŒ
  events:
  - ...golden

success:
  messages:
  - omg
  - Â¡LO HICISTE! ğŸ‰
  - buenÃ­simo, Â¡tu CPU ahora funciona correctamente!
  - podemos avanzar e integrarla con el emulador
  responses:
  - vamooo ğŸ¥³ [end]
